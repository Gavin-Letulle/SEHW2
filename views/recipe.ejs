<%- include('./partials/header', { currentPage: 'recipe' }) %>

<h1 style="text-align: center; margin-top: 35px"><%= recipe.recipe_name %></h1>

<div style="display: flex; flex-direction: column; align-items: center; text-align: center;">
  <img src="<%= recipe.img_url %>" alt="<%= recipe.recipe_name %>" style="width: 300px; margin-bottom: 20px;">
  <p><strong>Cooking Time:</strong> <%= recipe.cooking_time %></p>
  <h2>Instructions:</h2>
  <p><%= recipe.instructions %></p>
</div>

<h2 style="text-align: center;">Ingredients</h2>

<table style="margin: 0 auto; border-collapse: collapse; width: 50%;">
  <thead>
    <tr>
      <th style="border: 1px solid #ccc; padding: 8px; text-align: center;">Ingredient Name</th>
      <th style="border: 1px solid #ccc; padding: 8px; text-align: center;">Quantity</th>
    </tr>
  </thead>
  <tbody>
    <% ingredients.forEach((ingredient) => { %>
      <tr>
        <td style="border: 1px solid #ccc; padding: 8px; text-align: center; position: relative;">
          <span class="ingredient" data-info="<%= ingredient.highlight_info %>">
            <%= ingredient.ingredient_name %>
          </span>
        </td>

        <td style="border: 1px solid #ccc; padding: 8px; text-align: center;">
          <%= ingredient.quantity %>
        </td>
      </tr>
    <% }); %>
  </tbody>
</table>

<button id="recipesButton" style="display: block; margin: 30px auto; padding: 10px 20px; cursor: pointer;">Back To Recipes</button>

<script>
  document.querySelectorAll('.ingredient').forEach(item => {
    item.addEventListener('mouseover', (e) => {
      const info = e.target.getAttribute('data-info');
      const tooltip = document.createElement('div');
      tooltip.className = 'tooltip';
      tooltip.style.position = 'absolute';
      tooltip.style.backgroundColor = '#fff';
      tooltip.style.border = '1px solid #ccc';
      tooltip.style.padding = '5px';
      tooltip.style.zIndex = '1000';
      tooltip.style.whiteSpace = 'nowrap';
      tooltip.style.boxShadow = '0 2px 6px rgba(0,0,0,0.2)';
      tooltip.innerText = info;

      document.body.appendChild(tooltip);

      const rect = e.target.getBoundingClientRect();
      const tooltipRect = tooltip.getBoundingClientRect();

      let left = rect.left + window.scrollX;
      let top = rect.bottom + window.scrollY + 5;

      if (left + tooltipRect.width > window.innerWidth) {
        left = window.innerWidth - tooltipRect.width - 10; 
      }

      if (left < 0) {
        left = 10; 
      }

      tooltip.style.left = `${left}px`;
      tooltip.style.top = `${top}px`;

      e.target.addEventListener('mouseout', () => {
        tooltip.remove();
      }, { once: true });
    });
  });
</script>

<%- include('./partials/footer') %>